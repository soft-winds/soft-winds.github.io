[[toc]]

# use-dict 介绍

`use-dict` 是一个用于获取字典数据的 Vue Composition API 钩子函数。它可以帮助你在 Vue 组件中轻松地获取和使用字典数据。

## 代码

```js
import { onBeforeMount, ref } from "vue"; // 引入vue中的computed、onBeforeMount、ref函数
import request from "@/utils/request"; // 引入request函数
const cache = ref(new Map()); // 创建一个ref对象，用于缓存数据
export const useDict = (groupNo, apiUrl, obj) => {
  // 定义useDict函数，用于获取字典数据
  const dataSource = ref([]); // 创建一个ref对象，用于存储数据源
  const options = ref([]); // 创建一个ref对象，用于存储选项
  const value2Label = ref({}); // 创建一个ref对象，用于存储值和标签的映射关系
  const url = apiUrl || "/sysDictionary/detailsByAll"; // 设置请求的url，如果没有传入apiUrl，则默认为'/dictionary/detailsByAll'
  let params = { groupNo }; // 设置请求的参数
  onBeforeMount(async () => {
    // 在组件挂载前执行异步操作
    let list;
    let isSuccess;

    if (cache.value.get(groupNo)) {
      // 如果缓存中存在该groupNo的数据
      isSuccess = 200;
      list = cache.value.get(groupNo);
    } else {
      // 如果缓存中不存在该字典的数据
      if (obj) {
        params = obj;
      }
      const { data, httpCode } = await request({
        method: "post",
        url,
        data: params,
      }); // 发送请求获取数据
      isSuccess = httpCode;
      list = data;

      if (httpCode === 200) {
        // 如果请求成功
        cache.value.set(groupNo, data); // 将数据存入缓存
      }
    }
    if (isSuccess === 200) {
      // 如果请求成功
      const setData = (list) => {
        return list.map((item) => {
          value2Label.value[item.code] = item.name;
          return {
            label: item.name,
            value: item.code,
            children: item.children && setData(item.children),
          };
        });
      };
      options.value = setData(list);
      dataSource.value = list; // 将数据存入数据源
    }
  });
  const formatter = ({ text }) => {
    if (!text) return "-";
    return value2Label.value[text] ?? text;
  };

  return {
    options,
    formatter,
    dataSource,
  };
};
```

## 使用

```vue
<template>
  <div>
    <el-select v-model="value" placeholder="请选择" @change="handleChange">
      <el-option
        v-for="item in options"
        :key="item.value"
        :label="item.label"
        :value="item.value"
      >
      </el-option>
    </el-select>
  </div>
</template>
</template>
<script setup>
    import { useDict } from "@/hooks/use-dict";
    const { options, formatter } = useDict("user_status");
    // 获取字典数据label
    function handleChange(value) {
      console.log(formatter({ text: value }));
    }
</script>






```
