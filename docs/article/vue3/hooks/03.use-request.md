[[toc]]

# use-request 介绍

`use-request` 是一个用于处理 HTTP 请求的 Vue 组合式 API。它提供了一种简洁的方式来发起请求、处理响应和错误，并且可以与 Vue 的响应式系统无缝集成。

## 代码

```js
import { ref } from "vue";
import request from "@/utils/request";

export const queryData = async ({
  url,
  method = "post",
  data = {},
  params = {},
}) => {
  return await request[method](url, data, params);
};
export const useReuqest = (formatResult) => {
  const page = ref({
    pageNo: 1,
    pageSize: 10,
    total: 0,
  });
  const dataSource = ref([]);
  const loading = ref(false);
  page.value = {
    pageNo: 1,
    pageSize: 10,
    total: 0,
  };
  dataSource.value = [];
  return {
    loading: loading,
    dataSource,
    page,
    run: async (filter) => {
      try {
        let filterData = filter;
        if (filter.pages) {
          page.value.pageNo = filter.pages.current;
          page.value.pageSize = filter.pages.pageSize;
          page.value.total = filter.pages.total;
          filterData = { ...filter, ...page.value };
        }
        loading.value = true;
        const { httpCode, data } = await queryData(filterData);
        if (httpCode === 200) {
          dataSource.value = formatResult ? formatResult(data) : data;
        }
      } catch (error) {
        dataSource.value = [];
      } finally {
        loading.value = false;
      }
    },
  };
};
```

## 使用

```vue
<script setup>
import { useReuqest } from "@/hooks/use-request";
import { ref } from "vue";
const { loading, dataSource, page, run } = useReuqest((data) => {
  return data;
});
const filter = ref({
  url: "/api/table",
  method: "post",
  data: {
    name: "test",
  },
});
const fetchData = async () => {
  await run(filter.value);
};
fetchData();
</script>
```

## 参数

- `formatResult`：一个可选的函数，用于格式化请求的响应数据。默认情况下，`use-request` 会直接返回响应数据。如果提供了 `formatResult` 函数，它将接收响应数据作为参数，并返回格式化后的数据。

## 返回值

- `loading`：一个响应式变量，表示当前请求是否正在进行中。
- `dataSource`：一个响应式变量，用于存储请求的响应数据。
- `page`：一个响应式变量，用于存储分页信息。
