<template><div><h1 id="use-request-介绍" tabindex="-1"><a class="header-anchor" href="#use-request-介绍"><span>use-request 介绍</span></a></h1>
<p><code v-pre>use-request</code> 是一个用于处理 HTTP 请求的 Vue 组合式 API。它提供了一种简洁的方式来发起请求、处理响应和错误，并且可以与 Vue 的响应式系统无缝集成。</p>
<h2 id="代码" tabindex="-1"><a class="header-anchor" href="#代码"><span>代码</span></a></h2>
<div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre  class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff" v-pre=" language-javascript"><code><span class="line"><span class="line"><span style="color:#81A1C1">import</span><span style="color:#ECEFF4"> {</span><span style="color:#8FBCBB"> ref</span><span style="color:#ECEFF4"> }</span><span style="color:#81A1C1"> from</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">vue</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">import</span><span style="color:#8FBCBB"> request</span><span style="color:#81A1C1"> from</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">@/utils/request</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">export</span><span style="color:#81A1C1"> const</span><span style="color:#88C0D0"> queryData</span><span style="color:#81A1C1"> =</span><span style="color:#81A1C1"> async</span><span style="color:#D8DEE9FF"> (</span><span style="color:#ECEFF4">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">  url</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">  method</span><span style="color:#81A1C1"> =</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">post</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">  data</span><span style="color:#81A1C1"> =</span><span style="color:#ECEFF4"> {},</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">  params</span><span style="color:#81A1C1"> =</span><span style="color:#ECEFF4"> {},</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">}</span><span style="color:#D8DEE9FF">) </span><span style="color:#81A1C1">=></span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">  return</span><span style="color:#81A1C1"> await</span><span style="color:#D8DEE9"> request</span><span style="color:#D8DEE9FF">[</span><span style="color:#D8DEE9">method</span><span style="color:#D8DEE9FF">](</span><span style="color:#D8DEE9">url</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9"> data</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9"> params</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">}</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">export</span><span style="color:#81A1C1"> const</span><span style="color:#88C0D0"> useReuqest</span><span style="color:#81A1C1"> =</span><span style="color:#ECEFF4"> (</span><span style="color:#D8DEE9">formatResult</span><span style="color:#ECEFF4">)</span><span style="color:#81A1C1"> =></span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">  const</span><span style="color:#D8DEE9"> page</span><span style="color:#81A1C1"> =</span><span style="color:#88C0D0"> ref</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">{</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0">    pageNo</span><span style="color:#ECEFF4">:</span><span style="color:#B48EAD"> 1</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0">    pageSize</span><span style="color:#ECEFF4">:</span><span style="color:#B48EAD"> 10</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0">    total</span><span style="color:#ECEFF4">:</span><span style="color:#B48EAD"> 0</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">  }</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">  const</span><span style="color:#D8DEE9"> dataSource</span><span style="color:#81A1C1"> =</span><span style="color:#88C0D0"> ref</span><span style="color:#D8DEE9FF">([])</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">  const</span><span style="color:#D8DEE9"> loading</span><span style="color:#81A1C1"> =</span><span style="color:#88C0D0"> ref</span><span style="color:#D8DEE9FF">(</span><span style="color:#81A1C1">false</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">  page</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">value</span><span style="color:#81A1C1"> =</span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0">    pageNo</span><span style="color:#ECEFF4">:</span><span style="color:#B48EAD"> 1</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0">    pageSize</span><span style="color:#ECEFF4">:</span><span style="color:#B48EAD"> 10</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0">    total</span><span style="color:#ECEFF4">:</span><span style="color:#B48EAD"> 0</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">  }</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">  dataSource</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">value</span><span style="color:#81A1C1"> =</span><span style="color:#D8DEE9FF"> []</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">  return</span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0">    loading</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9"> loading</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">    dataSource</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">    page</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0">    run</span><span style="color:#ECEFF4">:</span><span style="color:#81A1C1"> async</span><span style="color:#ECEFF4"> (</span><span style="color:#D8DEE9">filter</span><span style="color:#ECEFF4">)</span><span style="color:#81A1C1"> =></span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">      try</span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">        let</span><span style="color:#D8DEE9"> filterData</span><span style="color:#81A1C1"> =</span><span style="color:#D8DEE9"> filter</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">        if</span><span style="color:#D8DEE9FF"> (</span><span style="color:#D8DEE9">filter</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">pages</span><span style="color:#D8DEE9FF">) </span><span style="color:#ECEFF4">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">          page</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">value</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">pageNo</span><span style="color:#81A1C1"> =</span><span style="color:#D8DEE9"> filter</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">pages</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">current</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">          page</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">value</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">pageSize</span><span style="color:#81A1C1"> =</span><span style="color:#D8DEE9"> filter</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">pages</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">pageSize</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">          page</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">value</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">total</span><span style="color:#81A1C1"> =</span><span style="color:#D8DEE9"> filter</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">pages</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">total</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">          filterData</span><span style="color:#81A1C1"> =</span><span style="color:#ECEFF4"> {</span><span style="color:#81A1C1"> ...</span><span style="color:#D8DEE9">filter</span><span style="color:#ECEFF4">,</span><span style="color:#81A1C1"> ...</span><span style="color:#D8DEE9">page</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">value</span><span style="color:#ECEFF4"> }</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">        }</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        loading</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">value</span><span style="color:#81A1C1"> =</span><span style="color:#81A1C1"> true;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">        const</span><span style="color:#ECEFF4"> {</span><span style="color:#D8DEE9"> httpCode</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9"> data</span><span style="color:#ECEFF4"> }</span><span style="color:#81A1C1"> =</span><span style="color:#81A1C1"> await</span><span style="color:#88C0D0"> queryData</span><span style="color:#D8DEE9FF">(</span><span style="color:#D8DEE9">filterData</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">        if</span><span style="color:#D8DEE9FF"> (</span><span style="color:#D8DEE9">httpCode</span><span style="color:#81A1C1"> ===</span><span style="color:#B48EAD"> 200</span><span style="color:#D8DEE9FF">) </span><span style="color:#ECEFF4">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">          dataSource</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">value</span><span style="color:#81A1C1"> =</span><span style="color:#D8DEE9"> formatResult</span><span style="color:#81A1C1"> ?</span><span style="color:#88C0D0"> formatResult</span><span style="color:#D8DEE9FF">(</span><span style="color:#D8DEE9">data</span><span style="color:#D8DEE9FF">) </span><span style="color:#81A1C1">:</span><span style="color:#D8DEE9"> data</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">        }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">      }</span><span style="color:#81A1C1"> catch</span><span style="color:#D8DEE9FF"> (</span><span style="color:#D8DEE9">error</span><span style="color:#D8DEE9FF">) </span><span style="color:#ECEFF4">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        dataSource</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">value</span><span style="color:#81A1C1"> =</span><span style="color:#D8DEE9FF"> []</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">      }</span><span style="color:#81A1C1"> finally</span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        loading</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">value</span><span style="color:#81A1C1"> =</span><span style="color:#81A1C1"> false;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">      }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">    },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">  }</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">}</span><span style="color:#81A1C1">;</span></span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="使用" tabindex="-1"><a class="header-anchor" href="#使用"><span>使用</span></a></h2>
<div class="language-vue line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="vue"><pre  class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff" v-pre=" language-vue"><code><span class="line"><span class="line"><span style="color:#81A1C1">&#x3C;script</span><span style="color:#8FBCBB"> setup</span><span style="color:#81A1C1">></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">import</span><span style="color:#ECEFF4"> {</span><span style="color:#8FBCBB"> useReuqest</span><span style="color:#ECEFF4"> }</span><span style="color:#81A1C1"> from</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">@/hooks/use-request</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">import</span><span style="color:#ECEFF4"> {</span><span style="color:#8FBCBB"> ref</span><span style="color:#ECEFF4"> }</span><span style="color:#81A1C1"> from</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">vue</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">const</span><span style="color:#ECEFF4"> {</span><span style="color:#D8DEE9"> loading</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9"> dataSource</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9"> page</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9"> run</span><span style="color:#ECEFF4"> }</span><span style="color:#81A1C1"> =</span><span style="color:#88C0D0"> useReuqest</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9">data</span><span style="color:#ECEFF4">)</span><span style="color:#81A1C1"> =></span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">  return</span><span style="color:#D8DEE9"> data</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">}</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">const</span><span style="color:#D8DEE9"> filter</span><span style="color:#81A1C1"> =</span><span style="color:#88C0D0"> ref</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">{</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0">  url</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">/api/table</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0">  method</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">post</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0">  data</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0">    name</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">test</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">  },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">}</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">const</span><span style="color:#88C0D0"> fetchData</span><span style="color:#81A1C1"> =</span><span style="color:#81A1C1"> async</span><span style="color:#ECEFF4"> ()</span><span style="color:#81A1C1"> =></span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">  await</span><span style="color:#88C0D0"> run</span><span style="color:#D8DEE9FF">(</span><span style="color:#D8DEE9">filter</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">value</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">}</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0">fetchData</span><span style="color:#D8DEE9FF">()</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">&#x3C;/script></span></span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="参数" tabindex="-1"><a class="header-anchor" href="#参数"><span>参数</span></a></h2>
<ul>
<li><code v-pre>formatResult</code>：一个可选的函数，用于格式化请求的响应数据。默认情况下，<code v-pre>use-request</code> 会直接返回响应数据。如果提供了 <code v-pre>formatResult</code> 函数，它将接收响应数据作为参数，并返回格式化后的数据。</li>
</ul>
<h2 id="返回值" tabindex="-1"><a class="header-anchor" href="#返回值"><span>返回值</span></a></h2>
<ul>
<li><code v-pre>loading</code>：一个响应式变量，表示当前请求是否正在进行中。</li>
<li><code v-pre>dataSource</code>：一个响应式变量，用于存储请求的响应数据。</li>
<li><code v-pre>page</code>：一个响应式变量，用于存储分页信息。</li>
</ul>
</div></template>


