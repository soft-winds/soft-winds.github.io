<template><div><nav class="table-of-contents"><ul><li><router-link to="#邮件服务配置">邮件服务配置</router-link><ul><li><router-link to="#_1-安装依赖">1. 安装依赖</router-link></li><li><router-link to="#_2-配置邮件模块">2. 配置邮件模块</router-link></li><li><router-link to="#_3-邮件模板设计">3. 邮件模板设计</router-link></li><li><router-link to="#_4-邮件发送服务">4. 邮件发送服务</router-link></li></ul></li><li><router-link to="#定时任务实现">定时任务实现</router-link><ul><li><router-link to="#_1-安装依赖-1">1. 安装依赖</router-link></li><li><router-link to="#_2-配置定时任务">2. 配置定时任务</router-link></li></ul></li><li><router-link to="#邮件队列实现">邮件队列实现</router-link><ul><li><router-link to="#_1-安装依赖-2">1. 安装依赖</router-link></li><li><router-link to="#_2-配置邮件队列">2. 配置邮件队列</router-link></li></ul></li><li><router-link to="#下一步">下一步</router-link></li></ul></nav>
<h1 id="nestjs-邮件服务集成" tabindex="-1"><a class="header-anchor" href="#nestjs-邮件服务集成"><span>NestJS 邮件服务集成</span></a></h1>
<h2 id="邮件服务配置" tabindex="-1"><a class="header-anchor" href="#邮件服务配置"><span>邮件服务配置</span></a></h2>
<h3 id="_1-安装依赖" tabindex="-1"><a class="header-anchor" href="#_1-安装依赖"><span>1. 安装依赖</span></a></h3>
<div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre  class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff" v-pre=" language-bash"><code><span class="line"><span class="line"><span style="color:#616E88"># 安装邮件相关依赖</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0">npm</span><span style="color:#A3BE8C"> install</span><span style="color:#A3BE8C"> @nestjs-modules/mailer</span><span style="color:#A3BE8C"> nodemailer</span><span style="color:#A3BE8C"> ejs</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0">npm</span><span style="color:#A3BE8C"> install</span><span style="color:#A3BE8C"> -D</span><span style="color:#A3BE8C"> @types/nodemailer</span></span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-配置邮件模块" tabindex="-1"><a class="header-anchor" href="#_2-配置邮件模块"><span>2. 配置邮件模块</span></a></h3>
<p>创建 <code v-pre>src/modules/mail/mail.module.ts</code>：</p>
<div class="language-typescript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre  class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff" v-pre=" language-typescript"><code><span class="line"><span class="line"><span style="color:#81A1C1">import</span><span style="color:#ECEFF4"> {</span><span style="color:#D8DEE9"> Module</span><span style="color:#ECEFF4"> }</span><span style="color:#81A1C1"> from</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">@nestjs/common</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">import</span><span style="color:#ECEFF4"> {</span><span style="color:#D8DEE9"> MailerModule</span><span style="color:#ECEFF4"> }</span><span style="color:#81A1C1"> from</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">@nestjs-modules/mailer</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">import</span><span style="color:#ECEFF4"> {</span><span style="color:#D8DEE9"> EjsAdapter</span><span style="color:#ECEFF4"> }</span><span style="color:#81A1C1"> from</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">@nestjs-modules/mailer/dist/adapters/ejs.adapter</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">import</span><span style="color:#ECEFF4"> {</span><span style="color:#D8DEE9"> join</span><span style="color:#ECEFF4"> }</span><span style="color:#81A1C1"> from</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">path</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">import</span><span style="color:#ECEFF4"> {</span><span style="color:#D8DEE9"> MailService</span><span style="color:#ECEFF4"> }</span><span style="color:#81A1C1"> from</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">./mail.service</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">import</span><span style="color:#ECEFF4"> {</span><span style="color:#D8DEE9"> ConfigModule</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9"> ConfigService</span><span style="color:#ECEFF4"> }</span><span style="color:#81A1C1"> from</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">@nestjs/config</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D08770">@Module</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">  imports</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9FF"> [</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">    MailerModule</span><span style="color:#ECEFF4">.</span><span style="color:#D08770">forRootAsync</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">      imports</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9FF"> [</span><span style="color:#D08770">ConfigModule</span><span style="color:#D8DEE9FF">]</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0">      useFactory</span><span style="color:#ECEFF4">:</span><span style="color:#81A1C1"> async</span><span style="color:#ECEFF4"> (</span><span style="color:#D8DEE9">config</span><span style="color:#81A1C1">:</span><span style="color:#8FBCBB"> ConfigService</span><span style="color:#ECEFF4">)</span><span style="color:#81A1C1"> =></span><span style="color:#D8DEE9FF"> (</span><span style="color:#ECEFF4">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        transport</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">          host</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9"> config</span><span style="color:#ECEFF4">.</span><span style="color:#D08770">get</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">"</span><span style="color:#A3BE8C">MAIL_HOST</span><span style="color:#ECEFF4">"</span><span style="color:#D8DEE9FF">)</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">          port</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9"> config</span><span style="color:#ECEFF4">.</span><span style="color:#D08770">get</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">"</span><span style="color:#A3BE8C">MAIL_PORT</span><span style="color:#ECEFF4">"</span><span style="color:#D8DEE9FF">)</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">          secure</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9"> config</span><span style="color:#ECEFF4">.</span><span style="color:#D08770">get</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">"</span><span style="color:#A3BE8C">MAIL_SECURE</span><span style="color:#ECEFF4">"</span><span style="color:#D8DEE9FF">)</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">          auth</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">            user</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9"> config</span><span style="color:#ECEFF4">.</span><span style="color:#D08770">get</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">"</span><span style="color:#A3BE8C">MAIL_USER</span><span style="color:#ECEFF4">"</span><span style="color:#D8DEE9FF">)</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">            pass</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9"> config</span><span style="color:#ECEFF4">.</span><span style="color:#D08770">get</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">"</span><span style="color:#A3BE8C">MAIL_PASS</span><span style="color:#ECEFF4">"</span><span style="color:#D8DEE9FF">)</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">          },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">        },</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        defaults</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">          from</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> `</span><span style="color:#A3BE8C">"</span><span style="color:#ECEFF4">${</span><span style="color:#D8DEE9">config</span><span style="color:#ECEFF4">.</span><span style="color:#D08770">get</span><span style="color:#ECEFF4">(</span><span style="color:#ECEFF4">"</span><span style="color:#A3BE8C">MAIL_FROM_NAME</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">)</span><span style="color:#ECEFF4">}</span><span style="color:#A3BE8C">" &#x3C;</span><span style="color:#ECEFF4">${</span><span style="color:#D8DEE9">config</span><span style="color:#ECEFF4">.</span><span style="color:#D08770">get</span><span style="color:#ECEFF4">(</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">            "</span><span style="color:#A3BE8C">MAIL_FROM</span><span style="color:#ECEFF4">"</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">          )</span><span style="color:#ECEFF4">}</span><span style="color:#A3BE8C">></span><span style="color:#ECEFF4">`</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">        },</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        template</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">          dir</span><span style="color:#ECEFF4">:</span><span style="color:#D08770"> join</span><span style="color:#D8DEE9FF">(</span><span style="color:#D08770">__dirname</span><span style="color:#ECEFF4">,</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">templates</span><span style="color:#ECEFF4">"</span><span style="color:#D8DEE9FF">)</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">          adapter</span><span style="color:#ECEFF4">:</span><span style="color:#81A1C1"> new</span><span style="color:#D08770"> EjsAdapter</span><span style="color:#D8DEE9FF">()</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">          options</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">            strict</span><span style="color:#ECEFF4">:</span><span style="color:#81A1C1"> true</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">          },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">        },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">      }</span><span style="color:#D8DEE9FF">)</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">      inject</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9FF"> [</span><span style="color:#D08770">ConfigService</span><span style="color:#D8DEE9FF">]</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">    }</span><span style="color:#D8DEE9FF">)</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF">  ]</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">  providers</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9FF"> [</span><span style="color:#D08770">MailService</span><span style="color:#D8DEE9FF">]</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">  exports</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9FF"> [</span><span style="color:#D08770">MailService</span><span style="color:#D8DEE9FF">]</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">}</span><span style="color:#D8DEE9FF">)</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">export</span><span style="color:#81A1C1"> class</span><span style="color:#8FBCBB"> MailModule</span><span style="color:#ECEFF4"> {}</span></span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-邮件模板设计" tabindex="-1"><a class="header-anchor" href="#_3-邮件模板设计"><span>3. 邮件模板设计</span></a></h3>
<p>创建 <code v-pre>src/modules/mail/templates/welcome.ejs</code>：</p>
<div class="language-html line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="html"><pre  class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff" v-pre=" language-html"><code><span class="line"><span class="line"><span style="color:#81A1C1">&#x3C;!DOCTYPE</span><span style="color:#8FBCBB"> html</span><span style="color:#81A1C1">></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">&#x3C;html></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">  &#x3C;head></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">    &#x3C;meta</span><span style="color:#8FBCBB"> charset</span><span style="color:#ECEFF4">=</span><span style="color:#ECEFF4">"</span><span style="color:#A3BE8C">utf-8</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1"> /></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">    &#x3C;title></span><span style="color:#D8DEE9FF">欢迎加入图片服务</span><span style="color:#81A1C1">&#x3C;/title></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">    &#x3C;style></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">      body</span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        font-family</span><span style="color:#ECEFF4">:</span><span style="color:#81A1C1"> Arial</span><span style="color:#ECEFF4">,</span><span style="color:#81A1C1"> sans-serif;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        line-height</span><span style="color:#ECEFF4">:</span><span style="color:#B48EAD"> 1.6</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        color</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> #</span><span style="color:#B48EAD">333</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">      }</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">      .</span><span style="color:#8FBCBB">container</span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        max-width</span><span style="color:#ECEFF4">:</span><span style="color:#B48EAD"> 600</span><span style="color:#81A1C1">px;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        margin</span><span style="color:#ECEFF4">:</span><span style="color:#B48EAD"> 0</span><span style="color:#81A1C1"> auto;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        padding</span><span style="color:#ECEFF4">:</span><span style="color:#B48EAD"> 20</span><span style="color:#81A1C1">px;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">      }</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">      .</span><span style="color:#8FBCBB">header</span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        text-align</span><span style="color:#ECEFF4">:</span><span style="color:#81A1C1"> center;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        padding</span><span style="color:#ECEFF4">:</span><span style="color:#B48EAD"> 20</span><span style="color:#81A1C1">px</span><span style="color:#B48EAD"> 0</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        background-color</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> #</span><span style="color:#B48EAD">f8f9fa</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">      }</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">      .</span><span style="color:#8FBCBB">content</span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        padding</span><span style="color:#ECEFF4">:</span><span style="color:#B48EAD"> 20</span><span style="color:#81A1C1">px</span><span style="color:#B48EAD"> 0</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">      }</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">      .</span><span style="color:#8FBCBB">footer</span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        text-align</span><span style="color:#ECEFF4">:</span><span style="color:#81A1C1"> center;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        padding</span><span style="color:#ECEFF4">:</span><span style="color:#B48EAD"> 20</span><span style="color:#81A1C1">px</span><span style="color:#B48EAD"> 0</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        font-size</span><span style="color:#ECEFF4">:</span><span style="color:#B48EAD"> 12</span><span style="color:#81A1C1">px;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        color</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> #</span><span style="color:#B48EAD">666</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">      }</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">    &#x3C;/style></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">  &#x3C;/head></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">  &#x3C;body></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">    &#x3C;div</span><span style="color:#8FBCBB"> class</span><span style="color:#ECEFF4">=</span><span style="color:#ECEFF4">"</span><span style="color:#A3BE8C">container</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1">></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">      &#x3C;div</span><span style="color:#8FBCBB"> class</span><span style="color:#ECEFF4">=</span><span style="color:#ECEFF4">"</span><span style="color:#A3BE8C">header</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1">></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">        &#x3C;h1></span><span style="color:#D8DEE9FF">欢迎加入图片服务</span><span style="color:#81A1C1">&#x3C;/h1></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">      &#x3C;/div></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">      &#x3C;div</span><span style="color:#8FBCBB"> class</span><span style="color:#ECEFF4">=</span><span style="color:#ECEFF4">"</span><span style="color:#A3BE8C">content</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1">></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">        &#x3C;p></span><span style="color:#D8DEE9FF">亲爱的 </span><span style="color:#D8DEE9">&#x3C;</span><span style="color:#D8DEE9FF">%= username %>,</span><span style="color:#81A1C1">&#x3C;/p></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">        &#x3C;p></span><span style="color:#D8DEE9FF">感谢您注册我们的图片服务！我们很高兴您能加入我们。</span><span style="color:#81A1C1">&#x3C;/p></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">        &#x3C;p></span><span style="color:#D8DEE9FF">您现在可以：</span><span style="color:#81A1C1">&#x3C;/p></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">        &#x3C;ul></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">          &#x3C;li></span><span style="color:#D8DEE9FF">上传和管理您的图片</span><span style="color:#81A1C1">&#x3C;/li></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">          &#x3C;li></span><span style="color:#D8DEE9FF">分享图片给其他用户</span><span style="color:#81A1C1">&#x3C;/li></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">          &#x3C;li></span><span style="color:#D8DEE9FF">探索其他用户分享的公开图片</span><span style="color:#81A1C1">&#x3C;/li></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">        &#x3C;/ul></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">        &#x3C;p></span><span style="color:#D8DEE9FF">如果您有任何问题，请随时联系我们。</span><span style="color:#81A1C1">&#x3C;/p></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">      &#x3C;/div></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">      &#x3C;div</span><span style="color:#8FBCBB"> class</span><span style="color:#ECEFF4">=</span><span style="color:#ECEFF4">"</span><span style="color:#A3BE8C">footer</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1">></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">        &#x3C;p></span><span style="color:#D8DEE9FF">此邮件由系统自动发送，请勿回复。</span><span style="color:#81A1C1">&#x3C;/p></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">      &#x3C;/div></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">    &#x3C;/div></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">  &#x3C;/body></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">&#x3C;/html></span></span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>创建 <code v-pre>src/modules/mail/templates/reset-password.ejs</code>：</p>
<div class="language-html line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="html"><pre  class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff" v-pre=" language-html"><code><span class="line"><span class="line"><span style="color:#81A1C1">&#x3C;!DOCTYPE</span><span style="color:#8FBCBB"> html</span><span style="color:#81A1C1">></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">&#x3C;html></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">  &#x3C;head></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">    &#x3C;meta</span><span style="color:#8FBCBB"> charset</span><span style="color:#ECEFF4">=</span><span style="color:#ECEFF4">"</span><span style="color:#A3BE8C">utf-8</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1"> /></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">    &#x3C;title></span><span style="color:#D8DEE9FF">重置密码</span><span style="color:#81A1C1">&#x3C;/title></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">    &#x3C;style></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">      body</span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        font-family</span><span style="color:#ECEFF4">:</span><span style="color:#81A1C1"> Arial</span><span style="color:#ECEFF4">,</span><span style="color:#81A1C1"> sans-serif;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        line-height</span><span style="color:#ECEFF4">:</span><span style="color:#B48EAD"> 1.6</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        color</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> #</span><span style="color:#B48EAD">333</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">      }</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">      .</span><span style="color:#8FBCBB">container</span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        max-width</span><span style="color:#ECEFF4">:</span><span style="color:#B48EAD"> 600</span><span style="color:#81A1C1">px;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        margin</span><span style="color:#ECEFF4">:</span><span style="color:#B48EAD"> 0</span><span style="color:#81A1C1"> auto;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        padding</span><span style="color:#ECEFF4">:</span><span style="color:#B48EAD"> 20</span><span style="color:#81A1C1">px;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">      }</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">      .</span><span style="color:#8FBCBB">header</span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        text-align</span><span style="color:#ECEFF4">:</span><span style="color:#81A1C1"> center;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        padding</span><span style="color:#ECEFF4">:</span><span style="color:#B48EAD"> 20</span><span style="color:#81A1C1">px</span><span style="color:#B48EAD"> 0</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        background-color</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> #</span><span style="color:#B48EAD">f8f9fa</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">      }</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">      .</span><span style="color:#8FBCBB">content</span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        padding</span><span style="color:#ECEFF4">:</span><span style="color:#B48EAD"> 20</span><span style="color:#81A1C1">px</span><span style="color:#B48EAD"> 0</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">      }</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">      .</span><span style="color:#8FBCBB">button</span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        display</span><span style="color:#ECEFF4">:</span><span style="color:#81A1C1"> inline-block;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        padding</span><span style="color:#ECEFF4">:</span><span style="color:#B48EAD"> 10</span><span style="color:#81A1C1">px</span><span style="color:#B48EAD"> 20</span><span style="color:#81A1C1">px;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        background-color</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> #</span><span style="color:#B48EAD">007bff</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        color</span><span style="color:#ECEFF4">:</span><span style="color:#81A1C1"> white;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        text-decoration</span><span style="color:#ECEFF4">:</span><span style="color:#81A1C1"> none;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        border-radius</span><span style="color:#ECEFF4">:</span><span style="color:#B48EAD"> 5</span><span style="color:#81A1C1">px;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">      }</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">      .</span><span style="color:#8FBCBB">footer</span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        text-align</span><span style="color:#ECEFF4">:</span><span style="color:#81A1C1"> center;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        padding</span><span style="color:#ECEFF4">:</span><span style="color:#B48EAD"> 20</span><span style="color:#81A1C1">px</span><span style="color:#B48EAD"> 0</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        font-size</span><span style="color:#ECEFF4">:</span><span style="color:#B48EAD"> 12</span><span style="color:#81A1C1">px;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        color</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> #</span><span style="color:#B48EAD">666</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">      }</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">    &#x3C;/style></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">  &#x3C;/head></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">  &#x3C;body></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">    &#x3C;div</span><span style="color:#8FBCBB"> class</span><span style="color:#ECEFF4">=</span><span style="color:#ECEFF4">"</span><span style="color:#A3BE8C">container</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1">></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">      &#x3C;div</span><span style="color:#8FBCBB"> class</span><span style="color:#ECEFF4">=</span><span style="color:#ECEFF4">"</span><span style="color:#A3BE8C">header</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1">></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">        &#x3C;h1></span><span style="color:#D8DEE9FF">重置密码</span><span style="color:#81A1C1">&#x3C;/h1></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">      &#x3C;/div></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">      &#x3C;div</span><span style="color:#8FBCBB"> class</span><span style="color:#ECEFF4">=</span><span style="color:#ECEFF4">"</span><span style="color:#A3BE8C">content</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1">></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">        &#x3C;p></span><span style="color:#D8DEE9FF">亲爱的 </span><span style="color:#D8DEE9">&#x3C;</span><span style="color:#D8DEE9FF">%= username %>,</span><span style="color:#81A1C1">&#x3C;/p></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">        &#x3C;p></span><span style="color:#D8DEE9FF">我们收到了重置您密码的请求。请点击下面的按钮重置密码：</span><span style="color:#81A1C1">&#x3C;/p></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">        &#x3C;p</span><span style="color:#8FBCBB"> style</span><span style="color:#ECEFF4">=</span><span style="color:#ECEFF4">"</span><span style="color:#A3BE8C">text-align: center;</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1">></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">          &#x3C;a</span><span style="color:#8FBCBB"> href</span><span style="color:#ECEFF4">=</span><span style="color:#ECEFF4">"</span><span style="color:#D8DEE9">&#x3C;</span><span style="color:#A3BE8C">%= resetUrl %></span><span style="color:#ECEFF4">"</span><span style="color:#8FBCBB"> class</span><span style="color:#ECEFF4">=</span><span style="color:#ECEFF4">"</span><span style="color:#A3BE8C">button</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1">></span><span style="color:#D8DEE9FF">重置密码</span><span style="color:#81A1C1">&#x3C;/a></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">        &#x3C;/p></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">        &#x3C;p></span><span style="color:#D8DEE9FF">如果您没有请求重置密码，请忽略此邮件。</span><span style="color:#81A1C1">&#x3C;/p></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">        &#x3C;p></span><span style="color:#D8DEE9FF">此链接将在1小时后失效。</span><span style="color:#81A1C1">&#x3C;/p></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">      &#x3C;/div></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">      &#x3C;div</span><span style="color:#8FBCBB"> class</span><span style="color:#ECEFF4">=</span><span style="color:#ECEFF4">"</span><span style="color:#A3BE8C">footer</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1">></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">        &#x3C;p></span><span style="color:#D8DEE9FF">此邮件由系统自动发送，请勿回复。</span><span style="color:#81A1C1">&#x3C;/p></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">      &#x3C;/div></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">    &#x3C;/div></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">  &#x3C;/body></span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">&#x3C;/html></span></span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-邮件发送服务" tabindex="-1"><a class="header-anchor" href="#_4-邮件发送服务"><span>4. 邮件发送服务</span></a></h3>
<p>创建 <code v-pre>src/modules/mail/mail.service.ts</code>：</p>
<div class="language-typescript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre  class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff" v-pre=" language-typescript"><code><span class="line"><span class="line"><span style="color:#81A1C1">import</span><span style="color:#ECEFF4"> {</span><span style="color:#D8DEE9"> Injectable</span><span style="color:#ECEFF4"> }</span><span style="color:#81A1C1"> from</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">@nestjs/common</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">import</span><span style="color:#ECEFF4"> {</span><span style="color:#D8DEE9"> MailerService</span><span style="color:#ECEFF4"> }</span><span style="color:#81A1C1"> from</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">@nestjs-modules/mailer</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">import</span><span style="color:#ECEFF4"> {</span><span style="color:#D8DEE9"> ConfigService</span><span style="color:#ECEFF4"> }</span><span style="color:#81A1C1"> from</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">@nestjs/config</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D08770">@Injectable</span><span style="color:#D8DEE9FF">()</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">export</span><span style="color:#81A1C1"> class</span><span style="color:#8FBCBB"> MailService</span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">  constructor</span><span style="color:#ECEFF4">(</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">    private</span><span style="color:#D8DEE9"> mailerService</span><span style="color:#81A1C1">:</span><span style="color:#8FBCBB"> MailerService</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">    private</span><span style="color:#D8DEE9"> configService</span><span style="color:#81A1C1">:</span><span style="color:#8FBCBB"> ConfigService</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">  )</span><span style="color:#ECEFF4"> {}</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">  async</span><span style="color:#88C0D0"> sendWelcomeEmail</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9">username</span><span style="color:#81A1C1">:</span><span style="color:#8FBCBB"> string</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9"> email</span><span style="color:#81A1C1">:</span><span style="color:#8FBCBB"> string</span><span style="color:#ECEFF4">)</span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">    await</span><span style="color:#81A1C1"> this</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">mailerService</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">sendMail</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">      to</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9"> email</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">      subject</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">欢迎加入图片服务</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">      template</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">welcome</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">      context</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        username</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">      },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">    }</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">  }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">  async</span><span style="color:#88C0D0"> sendPasswordResetEmail</span><span style="color:#ECEFF4">(</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">    username</span><span style="color:#81A1C1">:</span><span style="color:#8FBCBB"> string</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">    email</span><span style="color:#81A1C1">:</span><span style="color:#8FBCBB"> string</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">    resetToken</span><span style="color:#81A1C1">:</span><span style="color:#8FBCBB"> string</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">  )</span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">    const</span><span style="color:#D8DEE9"> resetUrl</span><span style="color:#81A1C1"> =</span><span style="color:#ECEFF4"> `${</span><span style="color:#81A1C1">this</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">configService</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">get</span><span style="color:#ECEFF4">(</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">      "</span><span style="color:#A3BE8C">FRONTEND_URL</span><span style="color:#ECEFF4">"</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">    )</span><span style="color:#ECEFF4">}</span><span style="color:#A3BE8C">/reset-password?token=</span><span style="color:#ECEFF4">${</span><span style="color:#D8DEE9">resetToken</span><span style="color:#ECEFF4">}`</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">    await</span><span style="color:#81A1C1"> this</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">mailerService</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">sendMail</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">      to</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9"> email</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">      subject</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">重置密码</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">      template</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">reset-password</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">      context</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        username</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        resetUrl</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">      },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">    }</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">  }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">  async</span><span style="color:#88C0D0"> sendPhotoSharedNotification</span><span style="color:#ECEFF4">(</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">    username</span><span style="color:#81A1C1">:</span><span style="color:#8FBCBB"> string</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">    email</span><span style="color:#81A1C1">:</span><span style="color:#8FBCBB"> string</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">    photoTitle</span><span style="color:#81A1C1">:</span><span style="color:#8FBCBB"> string</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">  )</span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">    await</span><span style="color:#81A1C1"> this</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">mailerService</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">sendMail</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">      to</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9"> email</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">      subject</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">图片分享通知</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">      template</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">photo-shared</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">      context</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        username</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        photoTitle</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">      },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">    }</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">  }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">}</span></span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="定时任务实现" tabindex="-1"><a class="header-anchor" href="#定时任务实现"><span>定时任务实现</span></a></h2>
<h3 id="_1-安装依赖-1" tabindex="-1"><a class="header-anchor" href="#_1-安装依赖-1"><span>1. 安装依赖</span></a></h3>
<div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre  class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff" v-pre=" language-bash"><code><span class="line"><span class="line"><span style="color:#616E88"># 安装定时任务相关依赖</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0">npm</span><span style="color:#A3BE8C"> install</span><span style="color:#A3BE8C"> @nestjs/schedule</span></span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-配置定时任务" tabindex="-1"><a class="header-anchor" href="#_2-配置定时任务"><span>2. 配置定时任务</span></a></h3>
<p>创建 <code v-pre>src/modules/schedule/schedule.service.ts</code>：</p>
<div class="language-typescript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre  class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff" v-pre=" language-typescript"><code><span class="line"><span class="line"><span style="color:#81A1C1">import</span><span style="color:#ECEFF4"> {</span><span style="color:#D8DEE9"> Injectable</span><span style="color:#ECEFF4"> }</span><span style="color:#81A1C1"> from</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">@nestjs/common</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">import</span><span style="color:#ECEFF4"> {</span><span style="color:#D8DEE9"> Cron</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9"> CronExpression</span><span style="color:#ECEFF4"> }</span><span style="color:#81A1C1"> from</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">@nestjs/schedule</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">import</span><span style="color:#ECEFF4"> {</span><span style="color:#D8DEE9"> MailService</span><span style="color:#ECEFF4"> }</span><span style="color:#81A1C1"> from</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">../mail/mail.service</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">import</span><span style="color:#ECEFF4"> {</span><span style="color:#D8DEE9"> UserService</span><span style="color:#ECEFF4"> }</span><span style="color:#81A1C1"> from</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">../user/user.service</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">import</span><span style="color:#ECEFF4"> {</span><span style="color:#D8DEE9"> PhotoService</span><span style="color:#ECEFF4"> }</span><span style="color:#81A1C1"> from</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">../photo/photo.service</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D08770">@Injectable</span><span style="color:#D8DEE9FF">()</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">export</span><span style="color:#81A1C1"> class</span><span style="color:#8FBCBB"> ScheduleService</span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">  constructor</span><span style="color:#ECEFF4">(</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">    private</span><span style="color:#D8DEE9"> mailService</span><span style="color:#81A1C1">:</span><span style="color:#8FBCBB"> MailService</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">    private</span><span style="color:#D8DEE9"> userService</span><span style="color:#81A1C1">:</span><span style="color:#8FBCBB"> UserService</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">    private</span><span style="color:#D8DEE9"> photoService</span><span style="color:#81A1C1">:</span><span style="color:#8FBCBB"> PhotoService</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">  )</span><span style="color:#ECEFF4"> {}</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D08770">  @Cron</span><span style="color:#D8DEE9FF">(</span><span style="color:#D8DEE9">CronExpression</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">EVERY_DAY_AT_9AM</span><span style="color:#D8DEE9FF">)</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">  async</span><span style="color:#88C0D0"> sendDailyDigest</span><span style="color:#ECEFF4">()</span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">    const</span><span style="color:#D8DEE9"> users</span><span style="color:#81A1C1"> =</span><span style="color:#81A1C1"> await</span><span style="color:#81A1C1"> this</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">userService</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">findAll</span><span style="color:#D8DEE9FF">()</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">    for</span><span style="color:#D8DEE9FF"> (</span><span style="color:#81A1C1">const</span><span style="color:#D8DEE9"> user</span><span style="color:#81A1C1"> of</span><span style="color:#D8DEE9"> users</span><span style="color:#D8DEE9FF">) </span><span style="color:#ECEFF4">{</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">      const</span><span style="color:#D8DEE9"> recentPhotos</span><span style="color:#81A1C1"> =</span><span style="color:#81A1C1"> await</span><span style="color:#81A1C1"> this</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">photoService</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">findRecentPhotos</span><span style="color:#D8DEE9FF">(</span><span style="color:#D8DEE9">user</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">id</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">      if</span><span style="color:#D8DEE9FF"> (</span><span style="color:#D8DEE9">recentPhotos</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">length</span><span style="color:#81A1C1"> ></span><span style="color:#B48EAD"> 0</span><span style="color:#D8DEE9FF">) </span><span style="color:#ECEFF4">{</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">        await</span><span style="color:#81A1C1"> this</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">mailService</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">sendMail</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">          to</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9"> user</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">email</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">          subject</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">每日图片摘要</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">          template</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">daily-digest</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">          context</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">            username</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9"> user</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">username</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">            photos</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9"> recentPhotos</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">          },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">        }</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">      }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">  }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D08770">  @Cron</span><span style="color:#D8DEE9FF">(</span><span style="color:#D8DEE9">CronExpression</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">EVERY_WEEK</span><span style="color:#D8DEE9FF">)</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">  async</span><span style="color:#88C0D0"> cleanupUnusedPhotos</span><span style="color:#ECEFF4">()</span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">    const</span><span style="color:#D8DEE9"> unusedPhotos</span><span style="color:#81A1C1"> =</span><span style="color:#81A1C1"> await</span><span style="color:#81A1C1"> this</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">photoService</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">findUnusedPhotos</span><span style="color:#D8DEE9FF">()</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">    for</span><span style="color:#D8DEE9FF"> (</span><span style="color:#81A1C1">const</span><span style="color:#D8DEE9"> photo</span><span style="color:#81A1C1"> of</span><span style="color:#D8DEE9"> unusedPhotos</span><span style="color:#D8DEE9FF">) </span><span style="color:#ECEFF4">{</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">      await</span><span style="color:#81A1C1"> this</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">photoService</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">remove</span><span style="color:#D8DEE9FF">(</span><span style="color:#D8DEE9">photo</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">id</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">  }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">}</span></span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="邮件队列实现" tabindex="-1"><a class="header-anchor" href="#邮件队列实现"><span>邮件队列实现</span></a></h2>
<h3 id="_1-安装依赖-2" tabindex="-1"><a class="header-anchor" href="#_1-安装依赖-2"><span>1. 安装依赖</span></a></h3>
<div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre  class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff" v-pre=" language-bash"><code><span class="line"><span class="line"><span style="color:#616E88"># 安装队列相关依赖</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0">npm</span><span style="color:#A3BE8C"> install</span><span style="color:#A3BE8C"> @nestjs/bull</span><span style="color:#A3BE8C"> bull</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0">npm</span><span style="color:#A3BE8C"> install</span><span style="color:#A3BE8C"> -D</span><span style="color:#A3BE8C"> @types/bull</span></span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-配置邮件队列" tabindex="-1"><a class="header-anchor" href="#_2-配置邮件队列"><span>2. 配置邮件队列</span></a></h3>
<p>创建 <code v-pre>src/modules/mail/mail.processor.ts</code>：</p>
<div class="language-typescript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre  class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff" v-pre=" language-typescript"><code><span class="line"><span class="line"><span style="color:#81A1C1">import</span><span style="color:#ECEFF4"> {</span><span style="color:#D8DEE9"> Process</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9"> Processor</span><span style="color:#ECEFF4"> }</span><span style="color:#81A1C1"> from</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">@nestjs/bull</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">import</span><span style="color:#ECEFF4"> {</span><span style="color:#D8DEE9"> Logger</span><span style="color:#ECEFF4"> }</span><span style="color:#81A1C1"> from</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">@nestjs/common</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">import</span><span style="color:#ECEFF4"> {</span><span style="color:#D8DEE9"> Job</span><span style="color:#ECEFF4"> }</span><span style="color:#81A1C1"> from</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">bull</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">import</span><span style="color:#ECEFF4"> {</span><span style="color:#D8DEE9"> MailService</span><span style="color:#ECEFF4"> }</span><span style="color:#81A1C1"> from</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">./mail.service</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D08770">@Processor</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">"</span><span style="color:#A3BE8C">mail</span><span style="color:#ECEFF4">"</span><span style="color:#D8DEE9FF">)</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">export</span><span style="color:#81A1C1"> class</span><span style="color:#8FBCBB"> MailProcessor</span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">  private</span><span style="color:#81A1C1"> readonly</span><span style="color:#D8DEE9FF"> logger </span><span style="color:#81A1C1">=</span><span style="color:#81A1C1"> new</span><span style="color:#88C0D0"> Logger</span><span style="color:#D8DEE9FF">(</span><span style="color:#D8DEE9">MailProcessor</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">name</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">  constructor</span><span style="color:#ECEFF4">(</span><span style="color:#81A1C1">private</span><span style="color:#D8DEE9"> mailService</span><span style="color:#81A1C1">:</span><span style="color:#8FBCBB"> MailService</span><span style="color:#ECEFF4">)</span><span style="color:#ECEFF4"> {}</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D08770">  @Process</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">"</span><span style="color:#A3BE8C">welcome</span><span style="color:#ECEFF4">"</span><span style="color:#D8DEE9FF">)</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">  async</span><span style="color:#88C0D0"> handleWelcome</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9">job</span><span style="color:#81A1C1">:</span><span style="color:#8FBCBB"> Job</span><span style="color:#ECEFF4">)</span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">    this</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">logger</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">debug</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">"</span><span style="color:#A3BE8C">Processing welcome email...</span><span style="color:#ECEFF4">"</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">    const</span><span style="color:#ECEFF4"> {</span><span style="color:#D8DEE9"> username</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9"> email</span><span style="color:#ECEFF4"> }</span><span style="color:#81A1C1"> =</span><span style="color:#D8DEE9"> job</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">data</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">    await</span><span style="color:#81A1C1"> this</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">mailService</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">sendWelcomeEmail</span><span style="color:#D8DEE9FF">(</span><span style="color:#D8DEE9">username</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9"> email</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">  }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D08770">  @Process</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">"</span><span style="color:#A3BE8C">reset-password</span><span style="color:#ECEFF4">"</span><span style="color:#D8DEE9FF">)</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">  async</span><span style="color:#88C0D0"> handlePasswordReset</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9">job</span><span style="color:#81A1C1">:</span><span style="color:#8FBCBB"> Job</span><span style="color:#ECEFF4">)</span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">    this</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">logger</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">debug</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">"</span><span style="color:#A3BE8C">Processing password reset email...</span><span style="color:#ECEFF4">"</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">    const</span><span style="color:#ECEFF4"> {</span><span style="color:#D8DEE9"> username</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9"> email</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9"> resetToken</span><span style="color:#ECEFF4"> }</span><span style="color:#81A1C1"> =</span><span style="color:#D8DEE9"> job</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">data</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">    await</span><span style="color:#81A1C1"> this</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">mailService</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">sendPasswordResetEmail</span><span style="color:#D8DEE9FF">(</span><span style="color:#D8DEE9">username</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9"> email</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9"> resetToken</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">  }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D08770">  @Process</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">"</span><span style="color:#A3BE8C">photo-shared</span><span style="color:#ECEFF4">"</span><span style="color:#D8DEE9FF">)</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">  async</span><span style="color:#88C0D0"> handlePhotoShared</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9">job</span><span style="color:#81A1C1">:</span><span style="color:#8FBCBB"> Job</span><span style="color:#ECEFF4">)</span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">    this</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">logger</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">debug</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">"</span><span style="color:#A3BE8C">Processing photo shared notification...</span><span style="color:#ECEFF4">"</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">    const</span><span style="color:#ECEFF4"> {</span><span style="color:#D8DEE9"> username</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9"> email</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9"> photoTitle</span><span style="color:#ECEFF4"> }</span><span style="color:#81A1C1"> =</span><span style="color:#D8DEE9"> job</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">data</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">    await</span><span style="color:#81A1C1"> this</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">mailService</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">sendPhotoSharedNotification</span><span style="color:#D8DEE9FF">(</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">      username</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">      email</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">      photoTitle</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF">    )</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">  }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">}</span></span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>修改 <code v-pre>src/modules/mail/mail.module.ts</code>：</p>
<div class="language-typescript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre  class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff" v-pre=" language-typescript"><code><span class="line"><span class="line"><span style="color:#81A1C1">import</span><span style="color:#ECEFF4"> {</span><span style="color:#D8DEE9"> Module</span><span style="color:#ECEFF4"> }</span><span style="color:#81A1C1"> from</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">@nestjs/common</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">import</span><span style="color:#ECEFF4"> {</span><span style="color:#D8DEE9"> BullModule</span><span style="color:#ECEFF4"> }</span><span style="color:#81A1C1"> from</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">@nestjs/bull</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">import</span><span style="color:#ECEFF4"> {</span><span style="color:#D8DEE9"> MailerModule</span><span style="color:#ECEFF4"> }</span><span style="color:#81A1C1"> from</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">@nestjs-modules/mailer</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">import</span><span style="color:#ECEFF4"> {</span><span style="color:#D8DEE9"> EjsAdapter</span><span style="color:#ECEFF4"> }</span><span style="color:#81A1C1"> from</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">@nestjs-modules/mailer/dist/adapters/ejs.adapter</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">import</span><span style="color:#ECEFF4"> {</span><span style="color:#D8DEE9"> join</span><span style="color:#ECEFF4"> }</span><span style="color:#81A1C1"> from</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">path</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">import</span><span style="color:#ECEFF4"> {</span><span style="color:#D8DEE9"> MailService</span><span style="color:#ECEFF4"> }</span><span style="color:#81A1C1"> from</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">./mail.service</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">import</span><span style="color:#ECEFF4"> {</span><span style="color:#D8DEE9"> MailProcessor</span><span style="color:#ECEFF4"> }</span><span style="color:#81A1C1"> from</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">./mail.processor</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">import</span><span style="color:#ECEFF4"> {</span><span style="color:#D8DEE9"> ConfigModule</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9"> ConfigService</span><span style="color:#ECEFF4"> }</span><span style="color:#81A1C1"> from</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">@nestjs/config</span><span style="color:#ECEFF4">"</span><span style="color:#81A1C1">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D08770">@Module</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">  imports</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9FF"> [</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">    BullModule</span><span style="color:#ECEFF4">.</span><span style="color:#D08770">registerQueue</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">      name</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">mail</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">    }</span><span style="color:#D8DEE9FF">)</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">    MailerModule</span><span style="color:#ECEFF4">.</span><span style="color:#D08770">forRootAsync</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">      imports</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9FF"> [</span><span style="color:#D08770">ConfigModule</span><span style="color:#D8DEE9FF">]</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0">      useFactory</span><span style="color:#ECEFF4">:</span><span style="color:#81A1C1"> async</span><span style="color:#ECEFF4"> (</span><span style="color:#D8DEE9">config</span><span style="color:#81A1C1">:</span><span style="color:#8FBCBB"> ConfigService</span><span style="color:#ECEFF4">)</span><span style="color:#81A1C1"> =></span><span style="color:#D8DEE9FF"> (</span><span style="color:#ECEFF4">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        transport</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">          host</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9"> config</span><span style="color:#ECEFF4">.</span><span style="color:#D08770">get</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">"</span><span style="color:#A3BE8C">MAIL_HOST</span><span style="color:#ECEFF4">"</span><span style="color:#D8DEE9FF">)</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">          port</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9"> config</span><span style="color:#ECEFF4">.</span><span style="color:#D08770">get</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">"</span><span style="color:#A3BE8C">MAIL_PORT</span><span style="color:#ECEFF4">"</span><span style="color:#D8DEE9FF">)</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">          secure</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9"> config</span><span style="color:#ECEFF4">.</span><span style="color:#D08770">get</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">"</span><span style="color:#A3BE8C">MAIL_SECURE</span><span style="color:#ECEFF4">"</span><span style="color:#D8DEE9FF">)</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">          auth</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">            user</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9"> config</span><span style="color:#ECEFF4">.</span><span style="color:#D08770">get</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">"</span><span style="color:#A3BE8C">MAIL_USER</span><span style="color:#ECEFF4">"</span><span style="color:#D8DEE9FF">)</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">            pass</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9"> config</span><span style="color:#ECEFF4">.</span><span style="color:#D08770">get</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">"</span><span style="color:#A3BE8C">MAIL_PASS</span><span style="color:#ECEFF4">"</span><span style="color:#D8DEE9FF">)</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">          },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">        },</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        defaults</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">          from</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> `</span><span style="color:#A3BE8C">"</span><span style="color:#ECEFF4">${</span><span style="color:#D8DEE9">config</span><span style="color:#ECEFF4">.</span><span style="color:#D08770">get</span><span style="color:#ECEFF4">(</span><span style="color:#ECEFF4">"</span><span style="color:#A3BE8C">MAIL_FROM_NAME</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">)</span><span style="color:#ECEFF4">}</span><span style="color:#A3BE8C">" &#x3C;</span><span style="color:#ECEFF4">${</span><span style="color:#D8DEE9">config</span><span style="color:#ECEFF4">.</span><span style="color:#D08770">get</span><span style="color:#ECEFF4">(</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">            "</span><span style="color:#A3BE8C">MAIL_FROM</span><span style="color:#ECEFF4">"</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">          )</span><span style="color:#ECEFF4">}</span><span style="color:#A3BE8C">></span><span style="color:#ECEFF4">`</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">        },</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">        template</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">          dir</span><span style="color:#ECEFF4">:</span><span style="color:#D08770"> join</span><span style="color:#D8DEE9FF">(</span><span style="color:#D08770">__dirname</span><span style="color:#ECEFF4">,</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">templates</span><span style="color:#ECEFF4">"</span><span style="color:#D8DEE9FF">)</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">          adapter</span><span style="color:#ECEFF4">:</span><span style="color:#81A1C1"> new</span><span style="color:#D08770"> EjsAdapter</span><span style="color:#D8DEE9FF">()</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">          options</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">            strict</span><span style="color:#ECEFF4">:</span><span style="color:#81A1C1"> true</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">          },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">        },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">      }</span><span style="color:#D8DEE9FF">)</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">      inject</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9FF"> [</span><span style="color:#D08770">ConfigService</span><span style="color:#D8DEE9FF">]</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">    }</span><span style="color:#D8DEE9FF">)</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF">  ]</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">  providers</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9FF"> [</span><span style="color:#D08770">MailService</span><span style="color:#ECEFF4">,</span><span style="color:#D08770"> MailProcessor</span><span style="color:#D8DEE9FF">]</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9">  exports</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9FF"> [</span><span style="color:#D08770">MailService</span><span style="color:#D8DEE9FF">]</span><span style="color:#ECEFF4">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4">}</span><span style="color:#D8DEE9FF">)</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1">export</span><span style="color:#81A1C1"> class</span><span style="color:#8FBCBB"> MailModule</span><span style="color:#ECEFF4"> {}</span></span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="下一步" tabindex="-1"><a class="header-anchor" href="#下一步"><span>下一步</span></a></h2>
<p>在下一篇文章中，我们将介绍：</p>
<ol>
<li>前端项目分析</li>
<li>技术栈详解</li>
<li>项目结构说明</li>
<li>核心功能实现</li>
</ol>
<p>敬请期待！</p>
</div></template>


